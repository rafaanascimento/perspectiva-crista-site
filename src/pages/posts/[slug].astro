---
import { getCollection, render } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';
import { getReadingTimeLabel } from '../../utils/readingTime';
import { getAuthorProfile, getCoverPath, getPostSlug } from '../../utils/postHelpers';

export async function getStaticPaths() {
  const posts = await getCollection('posts');

  return posts.map((post) => ({
    params: { slug: getPostSlug(post) },
    props: { post }
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const author = getAuthorProfile(post.data.author);
const readingTime = getReadingTimeLabel(post.body);
const slug = getPostSlug(post);
const description = post.data.description;
const image = getCoverPath(post.data.cover);
const canonical = `https://seudominio.com/posts/${slug}/`;
---

<PostLayout
  title={post.data.title}
  description={description}
  date={post.data.date}
  coverImage={image}
  image={image}
  canonical={canonical}
  type="article"
  readingTime={readingTime}
  series={post.data.series}
  author={author}
>
  <Content />
</PostLayout>

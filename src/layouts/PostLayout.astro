---
import BaseLayout from './BaseLayout.astro';
import AuthorCard from '../components/AuthorCard.astro';
import { formatDateBR } from '../utils/formatDateBR';

interface Props {
  title: string;
  date: Date | string;
  coverImage: string;
  author: {
    name: string;
    avatar: string;
    role: string;
    bio: string;
  };
}

const { title, date, coverImage, author } = Astro.props;

const fallbackCover =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(`
<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'>
  <rect width='1200' height='630' fill='#E5E7EB'/>
  <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
        fill='#6B7280' font-size='42' font-family='Arial, sans-serif'>
    Imagem de capa indisponível
  </text>
</svg>
`);
---

<BaseLayout title={title}>
  <article>
    <header class="post-header">
      <a class="back-link" href="/" aria-label="Voltar para a página inicial">
        <span class="back-icon" aria-hidden="true">←</span>
        <span>Voltar para a página inicial</span>
      </a>
      <h1>{title}</h1>
      <p class="meta">Por {author.name} • {formatDateBR(date)}</p>
    </header>

    <img
      class="cover"
      src={coverImage}
      alt={`Capa do artigo ${title}`}
      width="1200"
      height="630"
      loading="lazy"
      onerror={`this.onerror=null;this.src='${fallbackCover}';`}
    />

    <hr class="divider" />

    <section class="content">
      <slot />
    </section>

    <AuthorCard author={author} />
  </article>
</BaseLayout>

<style>
  article {
    max-width: 820px;
    padding-inline: clamp(1rem, 2vw, 1.5rem);
    display: grid;
    gap: clamp(1.2rem, 1rem + 1vw, 1.8rem);
  }

  .post-header h1 {
    margin: 0;
    font-size: clamp(1.95rem, 1.2rem + 2.4vw, 2.95rem);
    line-height: 1.18;
    letter-spacing: -0.014em;
    color: var(--text);
    font-family: var(--heading-font);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.45rem;
    margin-bottom: 0.85rem;
    padding: 0.42rem 0.7rem;
    border-radius: 999px;
    border: 1px solid var(--line);
    background: var(--surface-soft);
    font-family: var(--ui-font);
    font-size: 0.88rem;
    font-weight: 600;
    letter-spacing: 0.01em;
    text-decoration: none;
    color: var(--text-soft);
    transition: transform 0.2s ease, box-shadow 0.2s ease, color 0.2s ease,
      border-color 0.2s ease;
  }

  .back-link:hover,
  .back-link:focus-visible {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
    color: var(--text);
    border-color: color-mix(in srgb, var(--line) 72%, var(--accent) 28%);
  }

  .meta {
    margin: 0.62rem 0 0;
    font-family: var(--ui-font);
    font-size: 0.9rem;
    color: var(--text-soft);
  }

  .cover {
    width: 100%;
    display: block;
    border-radius: 0.9rem;
    border: 1px solid var(--line);
    background: var(--surface-soft);
    box-shadow: var(--shadow-sm);
  }

  .divider {
    margin: 0;
    border: 0;
    border-top: 1px solid var(--line);
  }

  .content {
    width: 100%;
    font-size: 1.08rem;
    line-height: 1.68;
    color: var(--text);
  }

  .content :global(p) {
    margin: 0 0 0.85em;
  }

  .content :global(h2),
  .content :global(h3) {
    margin: 1.4em 0 0.5em;
    color: var(--text);
    font-family: var(--heading-font);
    line-height: 1.28;
  }

  .content :global(h2) {
    font-size: clamp(1.35rem, 1.06rem + 1vw, 1.8rem);
  }

  .content :global(h3) {
    font-size: clamp(1.14rem, 1rem + 0.58vw, 1.35rem);
  }

  .content :global(blockquote) {
    margin: 1.1em 0;
    padding: 0.72em 0.9em;
    border-left: 3px solid color-mix(in srgb, var(--accent) 60%, var(--line) 40%);
    background: var(--surface-soft);
  }

  .content :global(ul),
  .content :global(ol) {
    margin: 0.15em 0 0.95em;
    padding-left: 1.35em;
  }

  .content :global(li + li) {
    margin-top: 0.34em;
  }

  @media (max-width: 768px) {
    article {
      padding-inline: 0.35rem;
      gap: 1.15rem;
    }

    .content {
      font-size: 1rem;
      line-height: 1.65;
    }
  }
</style>

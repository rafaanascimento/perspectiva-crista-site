---
import BaseLayout from './BaseLayout.astro';
import AuthorCard from '../components/AuthorCard.astro';
import { formatDateBR } from '../utils/formatDateBR';

interface Props {
  title: string;
  date: Date | string;
  coverImage: string;
  author: {
    name: string;
    avatar: string;
    role: string;
    bio: string;
  };
}

const { title, date, coverImage, author } = Astro.props;

const fallbackCover =
  "data:image/svg+xml;utf8," +
  encodeURIComponent(`
<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'>
  <rect width='1200' height='630' fill='#E5E7EB'/>
  <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
        fill='#6B7280' font-size='42' font-family='Arial, sans-serif'>
    Imagem de capa indisponível
  </text>
</svg>
`);
---

<BaseLayout title={title}>
  <article>
    <header class="post-header">
      <a class="back-link" href="/" aria-label="Voltar para a página inicial">
        <span class="back-icon" aria-hidden="true">←</span>
        <span>Voltar para a página inicial</span>
      </a>
      <h1>{title}</h1>
      <p class="meta">Por {author.name} • {formatDateBR(date)}</p>
    </header>

    <img
      class="cover"
      src={coverImage}
      alt={`Capa do artigo ${title}`}
      width="1200"
      height="630"
      loading="lazy"
      onerror={`this.onerror=null;this.src='${fallbackCover}';`}
    />

    <hr class="divider" />

    <section class="content">
      <slot />
    </section>

    <AuthorCard author={author} />
  </article>
</BaseLayout>

<style>
  article {
    display: grid;
    gap: clamp(1.5rem, 1.1rem + 1.8vw, 2.25rem);
  }

  .post-header {
    margin-top: -0.25rem;
  }

  .post-header h1 {
    margin: 0;
    font-size: clamp(2.1rem, 1.35rem + 2.5vw, 3.2rem);
    line-height: 1.14;
    letter-spacing: -0.015em;
    color: var(--text-strong);
    text-wrap: balance;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding: 0.45rem 0.72rem;
    border-radius: 999px;
    border: 1px solid var(--line);
    background: var(--surface-2);
    font-family: var(--ui-font);
    font-size: 0.9rem;
    font-weight: 600;
    letter-spacing: 0.008em;
    color: var(--muted);
    text-decoration: none;
    transition: color 200ms ease, border-color 200ms ease,
      background-color 200ms ease, box-shadow 200ms ease, transform 200ms ease;
  }

  .back-link:hover,
  .back-link:focus-visible {
    color: var(--text-strong);
    border-color: color-mix(in srgb, var(--line) 72%, var(--accent) 28%);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
  }

  .back-icon {
    font-size: 1rem;
    line-height: 1;
  }

  .meta {
    margin: 0.72rem 0 0;
    color: var(--muted);
    font-family: var(--ui-font);
    font-size: 0.95rem;
    letter-spacing: 0.01em;
  }

  .cover {
    display: block;
    width: 100%;
    border-radius: 1rem;
    border: 1px solid var(--line);
    background: var(--surface-2);
    box-shadow: var(--shadow-sm);
    transition: border-color 220ms ease, background-color 220ms ease,
      box-shadow 220ms ease;
  }

  .divider {
    width: 100%;
    border: 0;
    border-top: 1px solid var(--line);
    margin: 0;
  }

  .content {
    width: min(100%, 70ch);
    font-size: 1.14rem;
    line-height: 1.9;
    color: var(--text);
  }

  .content :global(p) {
    margin: 0 0 1.25em;
  }

  .content :global(h2),
  .content :global(h3) {
    margin: 1.9em 0 0.62em;
    line-height: 1.28;
    color: var(--text-strong);
    font-family: var(--ui-font);
    letter-spacing: -0.01em;
  }

  .content :global(h2) {
    font-size: clamp(1.45rem, 1.15rem + 1.1vw, 1.95rem);
  }

  .content :global(h3) {
    font-size: clamp(1.2rem, 1.03rem + 0.75vw, 1.45rem);
  }

  .content :global(ul),
  .content :global(ol) {
    margin: 0.2em 0 1.3em;
    padding-left: 1.4em;
  }

  .content :global(li + li) {
    margin-top: 0.45em;
  }

  .content :global(blockquote) {
    margin: 1.6em 0;
    padding: 0.8em 1em;
    border-left: 3px solid color-mix(in srgb, var(--accent) 65%, var(--line) 35%);
    background: var(--surface-2);
    color: var(--text);
  }

  .content :global(a) {
    text-decoration-thickness: 0.08em;
  }

  @media (max-width: 768px) {
    .content {
      width: 100%;
      font-size: 1.06rem;
      line-height: 1.82;
    }

    .content :global(h2),
    .content :global(h3) {
      margin-top: 1.7em;
    }
  }
</style>
